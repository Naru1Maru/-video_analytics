# Video Pipeline Optimization (UCF101)

Комплекс упражнений и экспериментов по ускорению и профилированию видеопайплайна для задач компьютерного зрения.
Проект включает **CPU/GPU декодирование**, **препроцессинг**, **DataLoader-параллелизм**, **overlap decode↔infer**, а также **near-real-time обработку видеопотока**.

---

## Цели проекта

* Проанализировать узкие места видеопайплайна (decode → preprocess → infer).
* Измерить влияние `num_workers`, `pin_memory`, `prefetch_factor` на скорость загрузки данных.
* Сравнить CPU и GPU препроцессинг и оценить реальный прирост.
* Реализовать overlap-пайплайн, скрывающий задержку декодирования.
* Построить near-real-time pipeline с измерением FPS, latency и jitter.
* Сравнить offline и streaming режимы обработки.

---

## Структура репозитория

### **1. `HW1.ipynb` — основной ноутбук с результатами задач**

Содержит полный разбор 11 задач:

* чтение видеокадров и построение датасета;
* влияние числа воркеров на скорость;
* профилирование пайплайна (CPU/GPU);
* сравнение PyAV и decord;
* препроцессинг CPU vs GPU;
* overlap decode ↔ infer;
* near-real-time pipeline;
* сравнение offline vs streaming режимов.

В ноутбуке приведены **графики**, **таблицы**, **метрики**, а также подробные **выводы по каждой задаче**, позволяющие оценить эффективность разных оптимизаций.

---

### **2. `video_pipeline_ucf101.py` — реализованный видеопайплайн**

В Python-модуле содержится вся логика, используемая ноутбуком:

* `read_clip` — чтение клипов через PyAV;
* `VideoDataset` + DataLoader;
* функции профилирования (Torch Profiler);
* сравнение декодеров (PyAV / decord);
* CPU и GPU препроцессинг;
* overlap-пайплайн с отдельным decode-потоком и CUDA Stream;
* near-real-time обработка видеопотока;
* мини-ДЗ: сравнение offline vs streaming режимов.

Файл служит как **исполняемая библиотека**, позволяющая многократно запускать эксперименты и использовать готовые пайплайны в других проектах.

---

## Основные результаты проекта

* **Ускорение DataLoader от num_workers=0 → 4 более чем в 60 раз**.
* **GPU-препроцессинг оказался быстрее CPU в 1600+ раз**.
* **Overlap-пайплайн снижает latency до ~2 ms**.
* **Near-real-time режим обеспечивает стабильную обработку с низким jitter (~0.3 ms)**.
* **offline режим достигает >16000 FPS**, но менее стабилен по времени.
* **PyAV в 2 раза быстрее decord на CPU**, но decord выигрывает в GPU-режиме (NVDEC).

Эти результаты демонстрируют, насколько сильно на производительность видеомоделей влияет структура пайплайна и правильная организация загрузки данных.

---

## Требования

* Python 3.9+
* PyTorch
* torchvision
* PyAV
* decord (опционально)
* Jupyter Notebook

---

## Как использовать

1. Открыть `HW1.ipynb` для воспроизведения всех задач и графиков.
2. Использовать функции из `video_pipeline_ucf101.py` для запуска пайплайна, профилирования или near-real-time обработки.
3. Подставлять свои модели или свои видео, чтобы анализировать производительность.
